from    comci.git_tscript  import main, parseargs
import  pytest

def test_version(capsys):
    main(['--version'])
    assert ' version ' in capsys.readouterr().out

def test_main_no_subcommand(capsys):
    with pytest.raises(SystemExit) as ex:  main([])
    assert 2 == ex.value.code \
       and 'command must be specified' in capsys.readouterr().err

def test_bad_subcommand(capsys):
    with pytest.raises(SystemExit) as ex:  main(['XXX'])
    assert 2 == ex.value.code \
       and 'invalid choice' in capsys.readouterr().err

def test_show(capsys):
    with pytest.raises(SystemExit) as ex:  main(['show'])
    assert 9 == ex.value.code \
       and 'unimplemented' in capsys.readouterr().err

def test_run(capsys):
    with pytest.raises(SystemExit) as ex:
        main(['run', 'foo', 'bar'])
    assert 2 == ex.value.code \
       and 'bad args' in capsys.readouterr().err
