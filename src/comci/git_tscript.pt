from    comci.git_tscript  import main, parseargs
import  pytest

####################################################################
#   Upper-level argument parsing.

def test_main_version(capsys):
    main(['--version'])
    assert ' version ' in capsys.readouterr().out

def test_main_no_subcommand(capsys):
    with pytest.raises(SystemExit) as ex:  main([])
    assert 2 == ex.value.code \
       and 'command must be specified' in capsys.readouterr().err

def test_main_bad_subcommand(capsys):
    with pytest.raises(SystemExit) as ex:  main(['XXX'])
    assert 2 == ex.value.code \
       and 'invalid choice' in capsys.readouterr().err

def test_main_calls_cmd(capsys):
    #   The 'show' subcommand works fine for the moment, but what we really
    #   are testing here is not that but just that the `args.cmd(args)`
    #   call occurs.
    with pytest.raises(SystemExit) as ex:  main(['show'])
    assert 9 == ex.value.code \
       and 'unimplemented' in capsys.readouterr().err
