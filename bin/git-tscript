#!/usr/bin/env python3

from    os  import chdir, getcwd
from    pathlib  import Path
from    stat  import S_IXUSR
from    sys  import stderr

from    pygit2  import *


def debug(*s):
    return
    print(*s, file=stderr)

def find_repo():
    cwd = getcwd()
    debug('cwd:', cwd)
    repo_path = discover_repository(cwd)
    debug('repo_path:', repo_path)
    repo = Repository(repo_path)
    debug('repo:', repo)
    return repo

def tscripts(project_root):
    for pts in sorted(project_root.glob('tscript/*')):
        is_exec = pts.stat().st_mode & S_IXUSR
        if not pts.is_file() or not is_exec: continue
        yield pts

def main():
    repo = find_repo()
    project_root = Path(repo.path).parent
    chdir(project_root)
    for ts in tscripts(project_root):
        print('━━━━━━━━━━━━ {}'.format(ts.name))

if __name__ == '__main__':
    main()
